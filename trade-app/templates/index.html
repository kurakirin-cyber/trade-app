<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>SFM ãƒˆãƒ¬ãƒ¼ãƒ‰æ”¯æ´ãƒ„ãƒ¼ãƒ«ï¼ˆ5åˆ†è¶³ï¼‹æ¿ â†’ AIåˆ¤å®šï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue",
        "Segoe UI", sans-serif;
      background: #f5f5f7;
      color: #222;
    }
    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px;
    }
    h1 {
      font-size: 20px;
      margin: 0 0 8px;
    }
    h2 {
      font-size: 18px;
      margin: 0 0 8px;
    }
    h3 {
      font-size: 16px;
      margin: 0 0 6px;
    }
    p {
      margin: 4px 0;
      line-height: 1.6;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
      padding: 14px 16px;
      margin-bottom: 16px;
    }
    .card-header {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 15px;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #eef2ff;
      color: #3730a3;
      margin-left: 6px;
    }
    .small {
      font-size: 12px;
      color: #666;
    }

    .label {
      font-size: 13px;
      font-weight: 600;
      margin: 10px 0 4px;
    }
    input[type="text"],
    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      outline: none;
    }
    input[type="text"]:focus,
    textarea:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px #2563eb33;
    }
    textarea {
      resize: vertical;
      min-height: 60px;
    }
    .file-input {
      font-size: 13px;
      margin-top: 4px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: #2563eb;
      color: #fff;
      margin-top: 12px;
    }
    .btn.secondary {
      background: #e5e7eb;
      color: #111827;
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .symbol-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }
    .symbol-pill {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: #e5e7eb;
      font-size: 12px;
      text-decoration: none;
      color: #111827;
      border: 1px solid transparent;
    }
    .symbol-pill.active {
      background: #2563eb;
      color: #fff;
    }

    .result-box {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 10px;
      background: #f1f5f9;
      font-size: 13px;
    }
    .result-row {
      margin: 4px 0;
    }

    .chip {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
    }
    .chip-buy {
      background: #dcfce7;
      color: #166534;
    }
    .chip-sell {
      background: #fee2e2;
      color: #991b1b;
    }
    .chip-hold {
      background: #e0f2fe;
      color: #075985;
    }

    .error {
      padding: 8px 10px;
      border-radius: 8px;
      background: #fee2e2;
      color: #991b1b;
      font-size: 13px;
      margin-bottom: 10px;
    }

    @media (min-width: 720px) {
      .grid-2 {
        display: grid;
        grid-template-columns: 1.1fr 1.1fr;
        gap: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>ğŸ“ˆ SFM ãƒˆãƒ¬ãƒ¼ãƒ‰æ”¯æ´ãƒ„ãƒ¼ãƒ«ï¼ˆ5åˆ†è¶³ï¼‹æ¿ â†’ AIåˆ¤å®šï¼‰</h1>
    <p class="small">
      ä¸Šéƒ¨ã§ç™»éŒ²ã—ãŸéŠ˜æŸ„ã®ç’°å¢ƒï¼ˆæ—¥è¶³ãƒ»ææ–™ãªã©ï¼‰ã‚’ä¿å­˜ã—ã¦ãŠãã¨ã€<br />
      5åˆ†è¶³ï¼‹æ¿ã§åˆ¤å®šã™ã‚‹ãŸã³ã«ã€ãã®ç’°å¢ƒæƒ…å ±ã‚‚è‡ªå‹•ã§è€ƒæ…®ã—ã¦ãã‚Œã¾ã™ã€‚
    </p>

    <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
    {% if error %}
    <div class="error">
      {{ error }}
    </div>
    {% endif %}

    <!-- ç™»éŒ²æ¸ˆã¿éŠ˜æŸ„ä¸€è¦§ -->
    <div class="card">
      <div class="card-header">
        âœ… ç™»éŒ²æ¸ˆã¿éŠ˜æŸ„
        <span class="badge">ã‚¿ãƒƒãƒ—ã§åˆ‡ã‚Šæ›¿ãˆ</span>
      </div>
      {% if envs and envs|length > 0 %}
        <div class="symbol-list">
          {% for code, info in envs.items() %}
            <a
              class="symbol-pill {% if selected_code == code %}active{% endif %}"
              href="/?code={{ code }}"
            >
              {{ code }}{% if info.name %} {{ info.name }}{% endif %}
            </a>
          {% endfor %}
        </div>
        {% if not selected_code %}
          <p class="small" style="margin-top:8px;">
            â€» éŠ˜æŸ„ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€ãã®éŠ˜æŸ„ã®ç’°å¢ƒè¦ç´„ãŒä¸‹ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
          </p>
        {% endif %}
      {% else %}
        <p class="small">ã¾ã ç™»éŒ²ã•ã‚ŒãŸéŠ˜æŸ„ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p>
      {% endif %}
    </div>

    <!-- é¸æŠä¸­éŠ˜æŸ„ã®ç’°å¢ƒè¦ç´„ -->
    {% if selected_env %}
    <div class="card">
      <div class="card-header">
        ğŸ“˜ é¸æŠä¸­ã®éŠ˜æŸ„
      </div>
      <p class="small">
        éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰: <strong>{{ selected_code }}</strong>
        {% if selected_env.name %} / éŠ˜æŸ„å: <strong>{{ selected_env.name }}</strong>{% endif %}
      </p>
      {% if selected_env.updated_at %}
      <p class="small">æœ€çµ‚æ›´æ–°: {{ selected_env.updated_at }}</p>
      {% endif %}
      <div class="result-box">
        <div class="result-row">
          <strong>ç’°å¢ƒè¦ç´„:</strong><br />
          {{ selected_env.summary }}
        </div>
      </div>
    </div>
    {% endif %}

    <!-- 2ã‚«ãƒ©ãƒ ï¼ˆPCï¼‰ã§ä¸¦ã¹ã‚‹é ˜åŸŸ -->
    <div class="grid-2">

      <!-- â‘  5åˆ†è¶³ï¼‹æ¿ã‹ã‚‰çŸ­æœŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ¤å®š -->
      <div class="card">
        <div class="card-header">
          â‘  5åˆ†è¶³ï¼‹æ¿ã‹ã‚‰çŸ­æœŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ¤å®š
        </div>
        <form method="post" enctype="multipart/form-data">
          <input type="hidden" name="mode" value="judge" />

          <div class="label">éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ï¼ˆåˆ¤å®šã™ã‚‹å¯¾è±¡ï¼‰</div>
          <input
            type="text"
            name="judge_symbol_code"
            placeholder="ä¾‹: 9434"
            value="{{ result.symbol_code if result else selected_code }}"
          />

          <div class="label">5åˆ†è¶³ãƒãƒ£ãƒ¼ãƒˆç”»åƒ</div>
          <input class="file-input" type="file" name="chart_image" accept="image/*" />

          <div class="label">æ°—é…å€¤ï¼ˆæ¿ï¼‰ç”»åƒ</div>
          <input class="file-input" type="file" name="board_image" accept="image/*" />

          <div class="label">è£œè¶³ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</div>
          <textarea
            name="judge_memo"
            placeholder="ä¾‹: è‡ªåˆ†ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¾¡æ ¼ã‚„ã€ç›´è¿‘ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ãªã©ãƒ¡ãƒ¢ã—ãŸã„ã“ã¨ãŒã‚ã‚Œã°ã€‚"
          ></textarea>

          <button type="submit" class="btn">AI ã«åˆ¤å®šã—ã¦ã‚‚ã‚‰ã†</button>
        </form>

        {% if result %}
        <div class="result-box">
          <div class="result-row">
            <strong>éŠ˜æŸ„:</strong>
            {{ result.symbol_code }}
            {% if result.symbol_name %} {{ result.symbol_name }}{% endif %}
          </div>

          <div class="result-row" style="margin-top:6px;">
            <strong>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:</strong>
            {% if result.action == "BUY" %}
              <span class="chip chip-buy">BUYï¼ˆè²·ã„å¯„ã‚Šï¼‰</span>
            {% elif result.action == "SELL" %}
              <span class="chip chip-sell">SELLï¼ˆå£²ã‚Šå¯„ã‚Šï¼‰</span>
            {% else %}
              <span class="chip chip-hold">HOLDï¼ˆæ§˜å­è¦‹ï¼‰</span>
            {% endif %}
          </div>

          <div class="result-row" style="margin-top:6px;">
            <strong>ç†ç”±:</strong><br />
            {{ result.reason }}
          </div>

          {% if result.buy_zone %}
          <div class="result-row" style="margin-top:6px;">
            <strong>è²·ã„ã‚’æ¤œè¨ã™ã‚‹ã‚¾ãƒ¼ãƒ³:</strong><br />
            {{ result.buy_zone }}
          </div>
          {% endif %}

          {% if result.sell_zone %}
          <div class="result-row" style="margin-top:6px;">
            <strong>å£²ã‚Šã‚’æ¤œè¨ã™ã‚‹ã‚¾ãƒ¼ãƒ³:</strong><br />
            {{ result.sell_zone }}
          </div>
          {% endif %}
        </div>
        {% endif %}
      </div>

      <!-- â‘¡ æ—¥è¶³ãƒ»ææ–™ãªã©ã®ç’°å¢ƒæƒ…å ±ã‚’ç™»éŒ²ï¼ˆéŠ˜æŸ„ã”ã¨ã«ä¿å­˜ï¼‰ -->
      <div class="card">
        <div class="card-header">
          â‘¡ æ—¥è¶³ãƒ»ææ–™ãªã©ã®ç’°å¢ƒæƒ…å ±ã‚’ç™»éŒ²ï¼ˆéŠ˜æŸ„ã”ã¨ã«ä¿å­˜ï¼‰
        </div>
        <form method="post" enctype="multipart/form-data">
          <input type="hidden" name="mode" value="update_env" />

          <div class="label">éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ï¼ˆå¿…é ˆï¼‰</div>
          <input
            type="text"
            name="env_symbol_code"
            placeholder="ä¾‹: 9434"
            value="{{ selected_code }}"
          />

          <div class="label">éŠ˜æŸ„åï¼ˆä»»æ„ãƒ»ãƒ¡ãƒ¢ä»£ã‚ã‚Šï¼‰</div>
          <input
            type="text"
            name="env_symbol_name"
            placeholder="ä¾‹: ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯"
            value="{% if selected_env and selected_env.name %}{{ selected_env.name }}{% endif %}"
          />

          <div class="label">æ—¥è¶³ãƒãƒ£ãƒ¼ãƒˆç”»åƒï¼ˆä»»æ„ï¼‰</div>
          <input
            class="file-input"
            type="file"
            name="daily_image"
            accept="image/*"
          />
          <p class="small">
            ä¸­æœŸãƒˆãƒ¬ãƒ³ãƒ‰ã‚’æŠŠæ¡ã™ã‚‹ãŸã‚ã®æ—¥è¶³ã‚¹ã‚¯ã‚·ãƒ§ã€‚æœªæŒ‡å®šãªã‚‰å‰å›ã®æƒ…å ±ãŒãã®ã¾ã¾æ®‹ã‚Šã¾ã™ã€‚
          </p>

          <div class="label">è¿½åŠ ã®å‚è€ƒç”»åƒï¼ˆä»»æ„ãƒ»è¤‡æ•°å¯ï¼‰</div>
          <input
            class="file-input"
            type="file"
            name="extra_images"
            accept="image/*"
            multiple
          />
          <p class="small">
            ä¾‹: 60åˆ†è¶³ãƒãƒ£ãƒ¼ãƒˆã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ã€ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã€å‡ºæ¥é«˜æƒ…å ±ã®ã‚¹ã‚¯ã‚·ãƒ§ãªã©ã€‚
          </p>

          <div class="label">å‚è€ƒã«ã—ã¦ã»ã—ã„URLï¼ˆä»»æ„ãƒ»è¤‡æ•°è¡ŒOKï¼‰</div>
          <textarea
            name="env_urls"
            placeholder="1è¡Œã«1ã¤ãšã¤ URL ã‚’å…¥åŠ›&#10;ä¾‹: https://www.example.com/ir/..."
          ></textarea>

          <div class="label">ç’°å¢ƒãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</div>
          <textarea
            name="env_memo"
            placeholder="IRã®è¦ç‚¹ã€è‡ªåˆ†ã®è¦‹ç«‹ã¦ã€æ³¨æ„ã—ã¦ãŠããŸã„ææ–™ãªã©ã€‚"
          ></textarea>

          <button type="submit" class="btn secondary">
            ã“ã®éŠ˜æŸ„ã®ç’°å¢ƒã‚’æ›´æ–°ã™ã‚‹
          </button>
        </form>
      </div>

    </div><!-- /.grid-2 -->

    <p class="small" style="margin-top:12px; text-align:center;">
      â€» ç™»éŒ²ã—ãŸç’°å¢ƒæƒ…å ±ã¯ã‚µãƒ¼ãƒãƒ¼å´ã«éŠ˜æŸ„ã”ã¨ã«ä¿å­˜ã•ã‚Œã€æ¬¡å›ä»¥é™ã®åˆ¤å®šã§è‡ªå‹•çš„ã«è€ƒæ…®ã•ã‚Œã¾ã™ã€‚
    </p>
  </div>
</body>
</html>
