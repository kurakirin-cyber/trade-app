<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>SFM ãƒˆãƒ¬ãƒ¼ãƒ‰æ”¯æ´ãƒ„ãƒ¼ãƒ«ï¼ˆ5åˆ†è¶³ï¼‹æ¿ â†’ AIåˆ¤å®šï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue",
        "Segoe UI", sans-serif;
      background: #f5f5f7;
      margin: 0;
      padding: 0;
    }
    .wrapper {
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
    }
    h1 {
      font-size: 20px;
      margin: 0 0 8px;
    }
    .sub {
      font-size: 12px;
      color: #666;
      line-height: 1.5;
      margin-bottom: 8px;
    }
    .alert {
      padding: 10px 12px;
      border-radius: 6px;
      margin-bottom: 10px;
      font-size: 13px;
    }
    .alert-error {
      background: #ffe4e4;
      color: #b00020;
    }
    .alert-ok {
      background: #e0f4ff;
      color: #00509e;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      padding: 14px 16px 16px;
      margin-bottom: 14px;
    }
    .card-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .card-title span.idx {
      font-weight: 700;
      color: #ff3366;
    }
    label {
      font-size: 13px;
      display: block;
      margin: 8px 0 4px;
    }
    input[type="text"],
    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 13px;
    }
    textarea {
      min-height: 72px;
      resize: vertical;
    }
    .hint {
      font-size: 11px;
      color: #777;
      margin-top: 2px;
    }
    .file-row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 4px;
    }
    .btn {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      padding: 10px 16px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      white-space: nowrap;
    }
    .btn-main {
      background: #007aff;
      color: #fff;
      width: 100%;
    }
    .btn-sub {
      background: #eee;
      color: #333;
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
    }
    .symbol-pill {
      display: inline-flex;
      align-items: center;
      padding: 5px 9px;
      border-radius: 999px;
      background: #f1f3f5;
      font-size: 12px;
      margin: 3px 4px 0 0;
      text-decoration: none;
      color: #333;
    }
    .symbol-pill span.code {
      font-weight: 600;
      margin-right: 4px;
    }
    .result-box {
      border-radius: 8px;
      padding: 10px 12px;
      background: #f0fbf2;
      border: 1px solid #a8e4b8;
      font-size: 13px;
      margin-top: 8px;
    }
    .result-box strong {
      font-size: 15px;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>ğŸ“ˆ SFM ãƒˆãƒ¬ãƒ¼ãƒ‰æ”¯æ´ãƒ„ãƒ¼ãƒ«ï¼ˆ5åˆ†è¶³ï¼‹æ¿ â†’ AIåˆ¤å®šï¼‰</h1>
    <div class="sub">
      ä¸Šã§ç™»éŒ²ã—ãŸéŠ˜æŸ„ã®ã€Œæ—¥è¶³ãƒ»ææ–™ãªã©ã®ç’°å¢ƒæƒ…å ±ã€ã‚’ä¿å­˜ã—ã¦ãŠãã¨ã€<br />
      5åˆ†è¶³ï¼‹æ¿ã§åˆ¤å®šã™ã‚‹ãŸã³ã«ã€ãã®ç’°å¢ƒæƒ…å ±ã‚‚è‡ªå‹•ã§è€ƒæ…®ã—ã¦ãã‚Œã¾ã™ã€‚
    </div>

    {% if error %}
    <div class="alert alert-error">{{ error }}</div>
    {% endif %}
    {% if env_message %}
    <div class="alert alert-ok">{{ env_message }}</div>
    {% endif %}

    <!-- ç™»éŒ²æ¸ˆã¿éŠ˜æŸ„ -->
    <div class="card">
      <div class="card-title">
        âœ… ç™»éŒ²æ¸ˆã¿éŠ˜æŸ„
      </div>
      {% if registered_list %}
        <div class="hint">éŠ˜æŸ„ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€ãã®éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ãŒãƒ•ã‚©ãƒ¼ãƒ ã«å…¥ã‚Šã¾ã™ã€‚</div>
        <div>
          {% for s in registered_list %}
          <a class="symbol-pill" href="/?code={{ s.code }}">
            <span class="code">{{ s.code }}</span>
            <span>{{ s.name }}</span>
          </a>
          {% endfor %}
        </div>
      {% else %}
        <div class="hint">ã¾ã ç™»éŒ²ã•ã‚ŒãŸéŠ˜æŸ„ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</div>
      {% endif %}
    </div>

    <!-- â‘  åˆ¤å®šãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="card">
      <div class="card-title">
        <span class="idx">â‘ </span> 5åˆ†è¶³ï¼‹æ¿ã‹ã‚‰çŸ­æœŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ¤å®š
      </div>

      <form method="post" enctype="multipart/form-data">
        <input type="hidden" name="form_type" value="judge" />

        <label>éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ï¼ˆåˆ¤å®šã™ã‚‹å¯¾è±¡ï¼‰</label>
        <input
          type="text"
          name="judge_symbol"
          placeholder="ä¾‹: 9984"
          value="{{ selected_code }}"
          inputmode="numeric"
        />

        <label>5åˆ†è¶³ãƒãƒ£ãƒ¼ãƒˆç”»åƒ</label>
        <div class="file-row">
          <input type="file" name="chart_image" accept="image/*" />
        </div>
        <div class="hint">5åˆ†è¶³ãƒãƒ£ãƒ¼ãƒˆã®ã‚¹ã‚¯ã‚·ãƒ§ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚</div>

        <label>æ°—é…å€¤ï¼ˆæ¿ï¼‰ç”»åƒ</label>
        <div class="file-row">
          <input type="file" name="board_image" accept="image/*" />
        </div>
        <div class="hint">æ¿ã®ã‚¹ã‚¯ã‚·ãƒ§ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚</div>

        <label>è£œè¶³ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
        <textarea
          name="judge_memo"
          placeholder="ä¾‹: è‡ªåˆ†ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¾¡æ ¼ã‚„ã€ç›´è¿‘ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ãªã©ãƒ¡ãƒ¢ã—ãŸã„ã“ã¨ãŒã‚ã‚Œã°ã€‚"
        ></textarea>

        <div style="margin-top: 12px;">
          <button type="submit" class="btn btn-main">AI ã«åˆ¤å®šã—ã¦ã‚‚ã‚‰ã†</button>
        </div>
      </form>

      {% if result %}
      <div class="result-box">
        <div><strong>åˆ¤å®šçµæœï¼ˆ{{ result.symbol }}ï¼‰</strong></div>
        <div>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: <strong>{{ result.action }}</strong></div>
        <div style="margin-top:4px;">ç†ç”±: {{ result.reason }}</div>
        {% if result.price_hint %}
        <div style="margin-top:4px;">ä¾¡æ ¼ã®ç›®å®‰: {{ result.price_hint }}</div>
        {% endif %}
      </div>
      {% endif %}
    </div>

    <!-- â‘¡ ç’°å¢ƒç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="card">
      <div class="card-title">
        <span class="idx">â‘¡</span> æ—¥è¶³ãƒ»ææ–™ãªã©ã®ç’°å¢ƒæƒ…å ±ã‚’ç™»éŒ²ï¼ˆéŠ˜æŸ„ã”ã¨ã«ä¿å­˜ï¼‰
      </div>

      <form method="post" enctype="multipart/form-data">
        <input type="hidden" name="form_type" value="env" />

        <label>éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ï¼ˆå¿…é ˆï¼‰</label>
        <input
          type="text"
          name="env_symbol"
          placeholder="ä¾‹: 9984"
          value="{{ selected_code }}"
          inputmode="numeric"
        />

        <label>éŠ˜æŸ„åï¼ˆä»»æ„ãƒ»ãƒ¡ãƒ¢ä»£ã‚ã‚Šï¼‰</label>
        <input
          type="text"
          name="env_name"
          placeholder="ä¾‹: ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—"
        />

        <label>æ—¥è¶³ãƒãƒ£ãƒ¼ãƒˆç”»åƒï¼ˆä»»æ„ï¼‰</label>
        <div class="file-row">
          <input type="file" name="daily_image" accept="image/*" />
        </div>

        <label>è¿½åŠ ã®å‚è€ƒç”»åƒï¼ˆä»»æ„ãƒ»è¤‡æ•°å¯ï¼‰</label>
        <div class="file-row">
          <input type="file" name="extra_images" accept="image/*" multiple />
        </div>
        <div class="hint">ä¾‹: 60åˆ†è¶³ãƒãƒ£ãƒ¼ãƒˆã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ã€ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãªã©ã®ã‚¹ã‚¯ã‚·ãƒ§ã€‚</div>

        <label>å‚è€ƒURLï¼ˆä»»æ„ãƒ»è¤‡æ•°è¡ŒOKï¼‰</label>
        <textarea
          name="env_urls"
          placeholder="1è¡Œã«ã¤ã1ã¤URLã‚’å…¥åŠ›&#10;ä¾‹: https://www.example.com/ir/..."
        ></textarea>

        <label>ç’°å¢ƒãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
        <textarea
          name="env_memo"
          placeholder="ä¾‹: æ±ºç®—å†…å®¹ã€ææ–™ã€åœ°åˆã„ãƒ¡ãƒ¢ãªã©ã€‚"
        ></textarea>

        <div style="margin-top: 12px;">
          <button type="submit" class="btn btn-main">
            ã“ã®éŠ˜æŸ„ã®ç’°å¢ƒã‚’æ›´æ–°ã™ã‚‹
          </button>
        </div>
      </form>
    </div>
  </div>
</body>
</html>
