<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>SFM ãƒˆãƒ¬ãƒ¼ãƒ‰æ”¯æ´ãƒ„ãƒ¼ãƒ«ï¼ˆ5åˆ†è¶³ï¼‹æ¿ â†’ AIåˆ¤å®šï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f7;
      color: #222;
    }
    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px;
    }
    h1 {
      font-size: 22px;
      margin: 0 0 4px;
    }
    h2 {
      font-size: 18px;
      margin: 0 0 8px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .label {
      font-size: 13px;
      color: #555;
      margin-bottom: 4px;
      display: block;
    }
    input[type="text"],
    textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    textarea {
      min-height: 80px;
      resize: vertical;
    }
    .input-row {
      margin-bottom: 10px;
    }
    .btn-primary {
      display: block;
      width: 100%;
      padding: 10px;
      border-radius: 999px;
      border: none;
      background: #0066ff;
      color: #fff;
      font-size: 16px;
      font-weight: 600;
    }
    .btn-primary:active {
      opacity: 0.85;
    }
    .alert {
      padding: 10px 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      font-size: 13px;
    }
    .alert-error {
      background: #ffe5e5;
      color: #b00020;
    }
    .alert-info {
      background: #e5f2ff;
      color: #004a9f;
    }
    .badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      background: #eee;
      margin-left: 4px;
    }
    .symbol-list {
      list-style: none;
      padding-left: 0;
      margin: 6px 0 0;
      font-size: 13px;
    }
    .symbol-list li {
      padding: 2px 0;
    }
    .result-box {
      white-space: pre-wrap;
      font-size: 14px;
      line-height: 1.5;
    }
  </style>
</head>
<body>
<div class="page">

  <h1>ğŸ“ˆ SFM ãƒˆãƒ¬ãƒ¼ãƒ‰æ”¯æ´ãƒ„ãƒ¼ãƒ«ï¼ˆ5åˆ†è¶³ï¼‹æ¿ â†’ AIåˆ¤å®šï¼‰</h1>
  <p style="font-size:13px; margin-top:4px;">
    ä¸Šéƒ¨ã§ç™»éŒ²ã—ãŸéŠ˜æŸ„ã®ã€Œæ—¥è¶³ãƒ»ææ–™ãªã©ã®ç’°å¢ƒã€ã‚’ä¿å­˜ã—ã¦ãŠãã¨ã€
    5åˆ†è¶³ï¼‹æ¿ã§åˆ¤å®šã™ã‚‹ãŸã³ã«ã€ãã®ç’°å¢ƒæƒ…å ±ã‚‚è‡ªå‹•ã§è€ƒæ…®ã—ã¦ãã‚Œã¾ã™ã€‚
  </p>

  {% if error %}
    <div class="alert alert-error">{{ error }}</div>
  {% endif %}
  {% if env_message %}
    <div class="alert alert-info">{{ env_message }}</div>
  {% endif %}

  <!-- ç™»éŒ²æ¸ˆã¿éŠ˜æŸ„ -->
  <div class="card">
    <h2>âœ… ç™»éŒ²æ¸ˆã¿éŠ˜æŸ„</h2>
    {% if contexts %}
      <ul class="symbol-list">
        {% for sym, ctx in contexts.items() %}
          <li>
            <strong>{{ sym }}</strong>
            {% if ctx.name %}ï¼ˆ{{ ctx.name }}ï¼‰{% endif %}
            {% if ctx.summary %}
              <span class="badge">ç’°å¢ƒãƒ¡ãƒ¢ã‚ã‚Š</span>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
      <p style="font-size:12px; color:#666; margin-top:6px;">
        â€» ç™»éŒ²æ¸ˆã¿ã®éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã‚’ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã™ã‚‹ã¨ã€ãã®éŠ˜æŸ„ã®ç’°å¢ƒã‚’åŠ å‘³ã—ã¦åˆ¤å®šã—ã¾ã™ã€‚
      </p>
    {% else %}
      <p style="font-size:13px; color:#666;">ã¾ã ç™»éŒ²ã•ã‚ŒãŸéŠ˜æŸ„ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p>
    {% endif %}
  </div>

  <!-- â‘  5åˆ†è¶³ï¼‹æ¿ã‹ã‚‰çŸ­æœŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ¤å®š -->
  <div class="card">
    <h2>â‘  5åˆ†è¶³ï¼‹æ¿ã‹ã‚‰çŸ­æœŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ¤å®š</h2>

    <form method="post" enctype="multipart/form-data">
      <input type="hidden" name="form_type" value="judge">

      <div class="input-row">
        <label class="label">éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ï¼ˆåˆ¤å®šã™ã‚‹å¯¾è±¡ï¼‰</label>
        <input type="text" name="judge_symbol" placeholder="ä¾‹: 9434" value="{{ judge_symbol }}">
      </div>

      <div class="input-row">
        <label class="label">5åˆ†è¶³ãƒãƒ£ãƒ¼ãƒˆç”»åƒ</label>
        <input type="file" name="chart_image" accept="image/*">
        <div style="font-size:11px; color:#777; margin-top:2px;">
          5åˆ†è¶³ãƒãƒ£ãƒ¼ãƒˆã®ã‚¹ã‚¯ã‚·ãƒ§ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚
        </div>
      </div>

      <div class="input-row">
        <label class="label">æ°—é…å€¤ï¼ˆæ¿ï¼‰ç”»åƒ</label>
        <input type="file" name="board_image" accept="image/*">
        <div style="font-size:11px; color:#777; margin-top:2px;">
          æ¿ã®ã‚¹ã‚¯ã‚·ãƒ§ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚
        </div>
      </div>

      <div class="input-row">
        <label class="label">è£œè¶³ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
        <textarea name="judge_memo"
          placeholder="ä¾‹: è‡ªåˆ†ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¾¡æ ¼ã‚„ã€ç›´è¿‘ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ãªã©ãƒ¡ãƒ¢ã—ã¦ãŠããŸã„ã“ã¨ãŒã‚ã‚Œã°ã€‚"></textarea>
      </div>

      <button type="submit" class="btn-primary">AI ã«åˆ¤å®šã—ã¦ã‚‚ã‚‰ã†</button>
    </form>

    {% if result %}
      <hr style="margin:16px 0;">
      <h3 style="font-size:16px; margin:0 0 6px;">ğŸ“Š åˆ¤å®šçµæœï¼ˆ{{ result.symbol }}ï¼‰</h3>
      <p style="font-size:13px; color:#555; margin:0 0 8px;">
        AI ã«ã‚ˆã‚‹ã–ã£ãã‚Šè§£èª¬ã§ã™ã€‚æœ€çµ‚åˆ¤æ–­ã¯ã”è‡ªèº«ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚
      </p>
      <div class="result-box">{{ result.full_text }}</div>
    {% endif %}
  </div>

  <!-- â‘¡ æ—¥è¶³ãƒ»ææ–™ãªã©ã®ç’°å¢ƒæƒ…å ±ã‚’ç™»éŒ²ï¼ˆéŠ˜æŸ„ã”ã¨ã«ä¿å­˜ï¼‰ -->
  <div class="card">
    <h2>â‘¡ æ—¥è¶³ãƒ»ææ–™ãªã©ã®ç’°å¢ƒæƒ…å ±ã‚’ç™»éŒ²ï¼ˆéŠ˜æŸ„ã”ã¨ã«ä¿å­˜ï¼‰</h2>

    <form method="post" enctype="multipart/form-data">
      <input type="hidden" name="form_type" value="env">

      <div class="input-row">
        <label class="label">éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ï¼ˆå¿…é ˆï¼‰</label>
        <input type="text" name="env_symbol" placeholder="ä¾‹: 9984" value="{{ env_symbol }}">
      </div>

      <div class="input-row">
        <label class="label">éŠ˜æŸ„åï¼ˆä»»æ„ãƒ»ãƒ¡ãƒ¢ä»£ã‚ã‚Šï¼‰</label>
        <input type="text" name="env_name" placeholder="ä¾‹: ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—">
      </div>

      <div class="input-row">
        <label class="label">æ—¥è¶³ãƒãƒ£ãƒ¼ãƒˆç”»åƒï¼ˆä»»æ„ï¼‰</label>
        <input type="file" name="daily_image" accept="image/*">
      </div>

      <div class="input-row">
        <label class="label">è¿½åŠ ã®å‚è€ƒç”»åƒï¼ˆä»»æ„ãƒ»è¤‡æ•°å¯ï¼‰</label>
        <input type="file" name="extra_images" accept="image/*" multiple>
      </div>

      <div class="input-row">
        <label class="label">å‚è€ƒã«ã—ã¦ã»ã—ã„URLï¼ˆä»»æ„ãƒ»è¤‡æ•°è¡ŒOKï¼‰</label>
        <textarea name="env_urls"
          placeholder="1è¡Œã«1ã¤ãšã¤URLã‚’å…¥åŠ›&#10;ä¾‹: https://www.example.com/ir/..."></textarea>
      </div>

      <div class="input-row">
        <label class="label">ç’°å¢ƒãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
        <textarea name="env_memo"
          placeholder="ä¾‹: ä¸­æœŸã¯ä¸Šæ˜‡ãƒˆãƒ¬ãƒ³ãƒ‰ã ãŒç›´è¿‘æ±ºç®—ã§å£²ã‚‰ã‚Œã¦èª¿æ•´ä¸­ã€€ãªã©"></textarea>
      </div>

      <button type="submit" class="btn-primary">ã“ã®éŠ˜æŸ„ã®ç’°å¢ƒã‚’æ›´æ–°ã™ã‚‹</button>
    </form>
  </div>

</div>
</body>
</html>
